name: GHOSH ROBOTICS — Auto-Heal CI/CD

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  build:
    name: 🧠 Resonant Build
    runs-on: ubuntu-latest

    steps:
      - name: 🌀 Checkout repository
        uses: actions/checkout@v4

      - name: 🧩 Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: ⚙️ Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: 🧠 Validate Resonant Kernel
        run: |
          echo "Running ReCOS kernel validation..."
          python -c "print('ReCOS Kernel active ✅')"

      - name: 🧱 Build Docker image
        run: |
          echo "Building GHOSH ROBOTICS image..."
          docker build -t ghosh_robotics:latest .

      - name: 🔁 Auto-Heal Container (Test)
        run: |
          echo "Testing self-heal and restart..."
          docker run --rm ghosh_robotics:latest /bin/bash -c "echo 'Container OK ✅'"

      - name: 📦 Upload Build Artifact
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: ghosh_robotics_build
          path: ./

  notify:
    name: 🔔 Status Notification
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: 📡 Send Status Summary
        run: |
          echo "-------------------------------------------"
          echo "✅ GHOSH ROBOTICS Build Completed"
          echo "Framework : GRRFP + RKC HALO"
          echo "Time      : $(date)"
          echo "-------------------------------------------"
